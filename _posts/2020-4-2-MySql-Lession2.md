-----------
post:layout
title:2020-3-22 MySQL基本用法
-----------
###一、创建计算字段
### 1 计算字段
存储在数据库中的数据一般不是应用程序所需要的格式，下面举几个例子。<br>

	>如果想在一个字段中既显示公司名，又显示公司的地址，但这两个信息一般包含在不同的表列中。
	>城市、州和邮编存储在不同的列中（应该这样），但邮件标签打印程序却需要把它们作为一个恰当的字段检索出来。
	>列数据是大小写混合的，但报表程序需要把所有数据按大些表示出来。
	>物品订单表存储物品的价格和数量，但不需要存储每个物品的总价格（用价格乘以数量即可）。为打印发票，需要物品的总价格。
	>需要根据表数据进行总数、平均数计算或其他计算。
在上述每个例子中，存储在表中的数据都不是程序所需要的。我们需要直接从数据库中检索除转换、计算或格式化过的数据；而不是检索出数据，然后再在客户机应用程序或报告程序中重新格式化。<BR>
这就是计算字段发挥作用的所在。字段（field）基本上于列（column）的意思相同，经常互换使用，不过数据列一般成为列，而术语字段通常用在计算字段的连接上。<br>
重要的是要注意到，只有数据库知道SELECT语句中哪些列是实际的表列，哪些列是计算字段。从客户机的角度来看，计算字段的数据是以与其他列的数据相同的的方式返回的。
###2 拼接字段
为了说明如何使用计算字段，举一个创建由两列组成的标题的简单例子。<br>
vendors表包含供应商名和位置信息，假如要生产一个供应商报告，需要在供应商的名字中按照name(location)这样的格式列出供应商的位置。<br>
此报表需要单个值，而表中数据存储在两个列vend_name和vend_country中。<br>
解决办法是把两个列拼接起来，在MySQL的SELECT语句中，可使用Concat（）函数来拼接两个列。

	MYSQL> SELECT CONCAT (VEND_NAME,"(",VEND_COUNTRY,")")
    -> FROM VENDORS
    -> ORDER BY VEND_NAME;
	+-----------------------------------------+
	| CONCAT (vend_name,"(",vend_country,")") |
	+-----------------------------------------+
	| ACME(USA)                               |
	| Anvils R Us(USA)                        |
	| Furball Inc.(USA)                       |
	| Jet Set(England)                        |
	| Jouets Et Ours(France)                  |
	| LT Supplies(USA)                        |
	+-----------------------------------------+
	6 rows in set (0.02 sec)
从上面可以看出，Concat()需要一个或多个指定的串，各个串之间用逗号分隔。若要删除数据右侧多余的空格来整理数据，可使用MYSQL的RTRIM(）函数来完成。如下：
	
	SELECT CONCAT(RTRIM(vend_name),'(',RTRIM(vend_country),')')
	FROM vendors
	ORDER BY vend_name;

RTRIM()函数去掉右边的所有空格。通过使用RTRIM(),各个列都进行了整理。同理，LTRIM()去掉串左边的空格，以及TRIM()去掉串左右两边的空格。

###3 使用别名
从前面的输出中可以看到，SELECT语句拼接地址字段工作得很好。但此计算列的名字是什么呢？实际上它没有名字，它只是一个值。如果仅在SQL查询工具中查看以下结果，这样没有什么不好，但是，一个
命名的列不能用于客户机中。<br>
为了解决这个问题，SQL支持列别名（alias）是一个字段或值得替代名。别名用AS关键字赋予。

	mysql> SELECT CONCAT(vend_name,"(",vend_city,")")
	    -> AS vend_title
	    -> FROM vendors
	    -> ORDER BY vend_name;
	+-------------------------+
	| vend_title              |
	+-------------------------+
	| ACME(Los Angeles)       |
	| Anvils R Us(Southfield) |
	| Furball Inc.(New York)  |
	| Jet Set(London)         |
	| Jouets Et Ours(Paris)   |
	| LT Supplies(Anytown)    |
	+-------------------------+
	6 rows in set (0.00 sec)

###4 执行算术计算
orderitems表中包含每个订单中的各项物品。

	mysql> select * from orderitems;
	+-----------+------------+---------+----------+------------+
	| order_num | order_item | prod_id | quantity | item_price |
	+-----------+------------+---------+----------+------------+
	|     20005 |          1 | ANV01   |       10 |       5.99 |
	|     20005 |          2 | ANV02   |        3 |       9.99 |
	|     20005 |          3 | TNT2    |        5 |      10.00 |
	|     20005 |          4 | FB      |        1 |      10.00 |
	|     20006 |          1 | JP2000  |        1 |      55.00 |
	|     20007 |          1 | TNT2    |      100 |      10.00 |
	|     20008 |          1 | FC      |       50 |       2.50 |
	|     20009 |          1 | FB      |        1 |      10.00 |
	|     20009 |          2 | OL1     |        1 |       8.99 |
	|     20009 |          3 | SLING   |        1 |       4.49 |
	|     20009 |          4 | ANV03   |        1 |      14.99 |
	+-----------+------------+---------+----------+------------+
	11 rows in set (0.00 sec)

若要汇总计算物品的价格（单价乘以订购数量）。可使用AS 将列表的计算术重命名。例如：

	mysql> SELECT order_num,order_item,prod_id,quantity,item_price,quantity*item_price AS expanded_price
	    -> FROM orderitems;
	+-----------+------------+---------+----------+------------+----------------+
	| order_num | order_item | prod_id | quantity | item_price | expanded_price |
	+-----------+------------+---------+----------+------------+----------------+
	|     20005 |          1 | ANV01   |       10 |       5.99 |          59.90 |
	|     20005 |          2 | ANV02   |        3 |       9.99 |          29.97 |
	|     20005 |          3 | TNT2    |        5 |      10.00 |          50.00 |
	|     20005 |          4 | FB      |        1 |      10.00 |          10.00 |
	|     20006 |          1 | JP2000  |        1 |      55.00 |          55.00 |
	|     20007 |          1 | TNT2    |      100 |      10.00 |        1000.00 |
	|     20008 |          1 | FC      |       50 |       2.50 |         125.00 |
	|     20009 |          1 | FB      |        1 |      10.00 |          10.00 |
	|     20009 |          2 | OL1     |        1 |       8.99 |           8.99 |
	|     20009 |          3 | SLING   |        1 |       4.49 |           4.49 |
	|     20009 |          4 | ANV03   |        1 |      14.99 |          14.99 |
	+-----------+------------+---------+----------+------------+----------------+
	11 rows in set (0.01 sec)
	
	mysql> select *,quantity*item_price AS expanded_price
	    -> from orderitems;
	+-----------+------------+---------+----------+------------+----------------+
	| order_num | order_item | prod_id | quantity | item_price | expanded_price |
	+-----------+------------+---------+----------+------------+----------------+
	|     20005 |          1 | ANV01   |       10 |       5.99 |          59.90 |
	|     20005 |          2 | ANV02   |        3 |       9.99 |          29.97 |
	|     20005 |          3 | TNT2    |        5 |      10.00 |          50.00 |
	|     20005 |          4 | FB      |        1 |      10.00 |          10.00 |
	|     20006 |          1 | JP2000  |        1 |      55.00 |          55.00 |
	|     20007 |          1 | TNT2    |      100 |      10.00 |        1000.00 |
	|     20008 |          1 | FC      |       50 |       2.50 |         125.00 |
	|     20009 |          1 | FB      |        1 |      10.00 |          10.00 |
	|     20009 |          2 | OL1     |        1 |       8.99 |           8.99 |
	|     20009 |          3 | SLING   |        1 |       4.49 |           4.49 |
	|     20009 |          4 | ANV03   |        1 |      14.99 |          14.99 |
	+-----------+------------+---------+----------+------------+----------------+
	11 rows in set (0.00 sec)

直接测试数据。
	可在mysql终端中通过SELECT 直接计算数据，例如
	mysql> select 2*3;
	+-----+
	| 2*3 |
	+-----+
	|   6 |
	+-----+
	1 row in set (0.00 sec)

	mysql> select ltrim("   bac   ");
	+--------------------+
	| ltrim("   bac   ") |
	+--------------------+
	| bac                |
	+--------------------+
	1 row in set (0.00 sec)